<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="alternate" href="/atom.xml" title="YanaChen" type="application/atom+xml">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"right","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="SSR （Server Side Render）与 CSR（Client Side Render） CSR 存在首屏白屏问题  CSR 需要浏览器加载 js 代码，再执行 js 代码生成 html 元素  加载再执行的耗时成本比较高，导致首屏加载会有短暂的白屏出现  seo 搜索引擎问题，客户端加载的是一些 js 文件，而大部分的搜索引擎 spider 只认识 html 文件内容，对 js 无感">
<meta name="keywords" content="webpack,SSR,服务端渲染">
<meta property="og:type" content="article">
<meta property="og:title" content="webpack之SSR">
<meta property="og:url" content="https://yanadev.github.io/2022/07/08/webpack 之 SSR（服务端渲染）/index.html">
<meta property="og:site_name" content="YanaChen">
<meta property="og:description" content="SSR （Server Side Render）与 CSR（Client Side Render） CSR 存在首屏白屏问题  CSR 需要浏览器加载 js 代码，再执行 js 代码生成 html 元素  加载再执行的耗时成本比较高，导致首屏加载会有短暂的白屏出现  seo 搜索引擎问题，客户端加载的是一些 js 文件，而大部分的搜索引擎 spider 只认识 html 文件内容，对 js 无感">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2022-08-15T12:45:04.842Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="webpack之SSR">
<meta name="twitter:description" content="SSR （Server Side Render）与 CSR（Client Side Render） CSR 存在首屏白屏问题  CSR 需要浏览器加载 js 代码，再执行 js 代码生成 html 元素  加载再执行的耗时成本比较高，导致首屏加载会有短暂的白屏出现  seo 搜索引擎问题，客户端加载的是一些 js 文件，而大部分的搜索引擎 spider 只认识 html 文件内容，对 js 无感">

<link rel="canonical" href="https://yanadev.github.io/2022/07/08/webpack 之 SSR（服务端渲染）/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>webpack之SSR | YanaChen</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">YanaChen</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">_踩坑_填坑_日常</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">102</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">104</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">87</span></a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://yanadev.github.io/2022/07/08/webpack 之 SSR（服务端渲染）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Yana">
      <meta itemprop="description" content="Never give up！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YanaChen">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          webpack之SSR
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-07-08 12:56:03" itemprop="dateCreated datePublished" datetime="2022-07-08T12:56:03+08:00">2022-07-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-15 20:45:04" itemprop="dateModified" datetime="2022-08-15T20:45:04+08:00">2022-08-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SSR/" itemprop="url" rel="index">
                    <span itemprop="name">SSR</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SSR/webpack/" itemprop="url" rel="index">
                    <span itemprop="name">webpack</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SSR/webpack/服务端渲染/" itemprop="url" rel="index">
                    <span itemprop="name">服务端渲染</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>26k</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="SSR-（Server-Side-Render）与-CSR（Client-Side-Render）"><a href="#SSR-（Server-Side-Render）与-CSR（Client-Side-Render）" class="headerlink" title="SSR （Server Side Render）与 CSR（Client Side Render）"></a>SSR （Server Side Render）与 CSR（Client Side Render）</h1><ul>
<li><p>CSR 存在首屏白屏问题</p>
</li>
<li><p>CSR 需要浏览器加载 js 代码，再执行 js 代码生成 html 元素</p>
</li>
<li><p>加载再执行的耗时成本比较高，导致首屏加载会有短暂的白屏出现</p>
</li>
<li><p>seo 搜索引擎问题，客户端加载的是一些 js 文件，而大部分的搜索引擎 spider 只认识 html 文件内容，对 js 无感</p>
</li>
</ul><a id="more"></a>
<h1 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h1><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir ssr-react</span><br><span class="line">cd ssr-react</span><br><span class="line">yarn init</span><br></pre></td></tr></table></figure>

<ul>
<li>创建 /src/*/index-server.js 入口文件</li>
<li>由于是服务端渲染不能使用 es6 import 语法，必须使用 cjs 方式 （require）</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> React = <span class="built_in">require</span>(<span class="string">'react'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="title">Search</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="xml">      This is Search Page</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/&gt;</span>;</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">&#125;;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> React = <span class="built_in">require</span>(<span class="string">'react'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>This is Index page<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/&gt;</span>;</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">&#125;;</span></span><br></pre></td></tr></table></figure>

<h1 id="配置-webpack-服务端打包文件"><a href="#配置-webpack-服务端打包文件" class="headerlink" title="配置 webpack 服务端打包文件"></a>配置 webpack 服务端打包文件</h1><h2 id="webpack-ssr-js-配置文件"><a href="#webpack-ssr-js-配置文件" class="headerlink" title="webpack.ssr.js 配置文件"></a>webpack.ssr.js 配置文件</h2><ul>
<li>创建 webpack.ssr.js 文件<ul>
<li>包括 entry、output、module、plugins、mode … 模块</li>
</ul>
</li>
<li>配合 glob 读取多个入口文件，配置多入口打包</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add glob -D</span><br></pre></td></tr></table></figure>

<ul>
<li>配置 webpack.ssr.js 文件</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> setMPA = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> entry = &#123;&#125;;</span><br><span class="line">  <span class="keyword">let</span> url = path.join(__dirname, <span class="string">'/src/*/index-server.jsx'</span>).replaceAll(<span class="string">'\\'</span>, <span class="string">'/'</span>);</span><br><span class="line">  <span class="keyword">const</span> entryFiles = glob.sync(url);</span><br><span class="line">  <span class="built_in">Object</span>.keys(entryFiles).map(<span class="function"><span class="params">index</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> entryFile = entryFiles[index];</span><br><span class="line">    <span class="keyword">let</span> match = entryFile.match(<span class="regexp">/src\/(.*)\/index-server.jsx/</span>);</span><br><span class="line">    <span class="keyword">const</span> pageName = match &amp;&amp; match[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span> (pageName) &#123;</span><br><span class="line">      entry[pageName] = entryFile;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; entry &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; entry &#125; = setMPA();</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="配置打包脚本"><a href="#配置打包脚本" class="headerlink" title="配置打包脚本"></a>配置打包脚本</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">"scripts":&#123;</span><br><span class="line">    "build": "webpack --config webpack.ssr.js"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add webpack webpack-cli react react-dom -D</span><br></pre></td></tr></table></figure>

<h2 id="es6-模块兼容"><a href="#es6-模块兼容" class="headerlink" title="es6 模块兼容"></a>es6 模块兼容</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add babel-loader @babel/preset-env @babel/preset-react @babel/core -D</span><br></pre></td></tr></table></figure>

<ul>
<li>配置 webpack.ssr.js </li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(js|jsx)$/</span>,</span><br><span class="line">                use: [<span class="string">'babel-loader'</span>]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>package.json 文件配置 babel 或者新建 .babelrc 文件（二选一）</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    "babel": &#123;</span><br><span class="line">        "presets": [</span><br><span class="line">            "@babel/preset-env",</span><br><span class="line">            <span class="string">"@babel/preset-react"</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="重新构建，自动清除构建文件"><a href="#重新构建，自动清除构建文件" class="headerlink" title="重新构建，自动清除构建文件"></a>重新构建，自动清除构建文件</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add clean-webpack-plugin -D</span><br></pre></td></tr></table></figure>

<ul>
<li>webpack.ssr.js</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;CleanWebpackPlugin&#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="动态生成-html-模板"><a href="#动态生成-html-模板" class="headerlink" title="动态生成 html 模板"></a>动态生成 html 模板</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add html-webpack-plugin -D</span><br></pre></td></tr></table></figure>

<ul>
<li>配置 webpack.ssr.js </li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> setMPA = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> entry = &#123;&#125;;</span><br><span class="line">  <span class="keyword">let</span> htmlWebpackPlugins = [];</span><br><span class="line">  <span class="keyword">let</span> url = path.join(__dirname, <span class="string">'/src/*/index-server.jsx'</span>).replaceAll(<span class="string">'\\'</span>, <span class="string">'/'</span>);</span><br><span class="line">  <span class="keyword">const</span> entryFiles = glob.sync(url);</span><br><span class="line">  <span class="built_in">Object</span>.keys(entryFiles).map(<span class="function"><span class="params">index</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> entryFile = entryFiles[index];</span><br><span class="line">    <span class="keyword">let</span> match = entryFile.match(<span class="regexp">/src\/(.*)\/index-server.jsx/</span>);</span><br><span class="line">    <span class="keyword">const</span> pageName = match &amp;&amp; match[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span> (pageName) &#123;</span><br><span class="line">      entry[pageName] = entryFile;</span><br><span class="line">      htmlWebpackPlugins.push(</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">          template: path.join(__dirname, <span class="string">`/src/<span class="subst">$&#123;pageName&#125;</span>/index.html`</span>),</span><br><span class="line">          filename: <span class="string">`<span class="subst">$&#123;pageName&#125;</span>.html`</span>,</span><br><span class="line">          chunks: [<span class="string">'vendors'</span>, pageName],</span><br><span class="line">          inject: <span class="literal">true</span>,</span><br><span class="line">          minify: &#123;</span><br><span class="line">            html5: <span class="literal">true</span>,</span><br><span class="line">            collapseWhitespace: <span class="literal">true</span>,</span><br><span class="line">            preserveLineBreaks: <span class="literal">false</span>,</span><br><span class="line">            minifyCSS: <span class="literal">true</span>,</span><br><span class="line">            minifyJS: <span class="literal">true</span>,</span><br><span class="line">            removeComments: <span class="literal">false</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> &#123; entry, htmlWebpackPlugins &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; entry, htmlWebpackPlugins &#125; = setMPA();</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins:[</span><br><span class="line">        ...</span><br><span class="line">    ].concat(htmlWebpackPlugins)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="分离基础包"><a href="#分离基础包" class="headerlink" title="分离基础包"></a>分离基础包</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add html-webpack-externals-plugin -D</span><br></pre></td></tr></table></figure>

<ul>
<li>多入口文件需要每个入口文件模板指定 cdn 地址，否则每个入口文件都会叠加引入 cdn，导致入口文件中引入多次 cdn</li>
<li>当 mode 设置为  none 时候，此时会报错：process undefined，需要手动设置 process.env 为全局属性</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackExternalsPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-externals-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> glob = <span class="built_in">require</span>(<span class="string">'glob'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> setMPA = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> entry = &#123;&#125;;</span><br><span class="line">  <span class="keyword">let</span> htmlWebpackPlugins = [];</span><br><span class="line">  <span class="keyword">let</span> HtmlWebpackExternalsPlugins = [];</span><br><span class="line">  <span class="keyword">let</span> url = path.join(__dirname, <span class="string">'/src/*/index.jsx'</span>).replaceAll(<span class="string">'\\'</span>, <span class="string">'/'</span>);</span><br><span class="line">  <span class="keyword">const</span> entryFiles = glob.sync(url);</span><br><span class="line">  <span class="built_in">Object</span>.keys(entryFiles).map(<span class="function"><span class="params">index</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> entryFile = entryFiles[index];</span><br><span class="line">    <span class="keyword">let</span> match = entryFile.match(<span class="regexp">/src\/(.*)\/index.jsx/</span>);</span><br><span class="line">    <span class="keyword">const</span> pageName = match &amp;&amp; match[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span> (pageName) &#123;</span><br><span class="line">      entry[pageName] = entryFile;</span><br><span class="line">      <span class="comment">// 每个入口文件设置 基础库的cdn</span></span><br><span class="line">      HtmlWebpackExternalsPlugins.push(<span class="keyword">new</span> HtmlWebpackExternalsPlugin(&#123;</span><br><span class="line">        externals: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="built_in">module</span>: <span class="string">'react'</span>,</span><br><span class="line">            entry: <span class="string">'https://unpkg.com/react@18/umd/react.development.js'</span>,</span><br><span class="line">            global: <span class="string">'React'</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="built_in">module</span>: <span class="string">'react-dom'</span>,</span><br><span class="line">            entry: <span class="string">'https://unpkg.com/react-dom@18/umd/react-dom.development.js'</span>,</span><br><span class="line">            global: <span class="string">'ReactDOM'</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        files: [<span class="string">`<span class="subst">$&#123;pageName&#125;</span>.html`</span>]</span><br><span class="line">      &#125;));</span><br><span class="line">      <span class="comment">// 入口文件生成模板</span></span><br><span class="line">      htmlWebpackPlugins.push(</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">          template: path.join(__dirname, <span class="string">`/src/<span class="subst">$&#123;pageName&#125;</span>/index.html`</span>),</span><br><span class="line">          filename: <span class="string">`<span class="subst">$&#123;pageName&#125;</span>.html`</span>,</span><br><span class="line">          chunks: [pageName],</span><br><span class="line">          inject: <span class="literal">true</span>,</span><br><span class="line">          minify: &#123;</span><br><span class="line">            html5: <span class="literal">true</span>,</span><br><span class="line">            collapseWhitespace: <span class="literal">true</span>,</span><br><span class="line">            preserveLineBreaks: <span class="literal">false</span>,</span><br><span class="line">            minifyCSS: <span class="literal">true</span>,</span><br><span class="line">            minifyJS: <span class="literal">true</span>,</span><br><span class="line">            removeComments: <span class="literal">false</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; entry, htmlWebpackPlugins, HtmlWebpackExternalsPlugins &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; entry, htmlWebpackPlugins, HtmlWebpackExternalsPlugins &#125; = setMPA();</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'[name].js'</span>,</span><br><span class="line">    path: path.join(__dirname, <span class="string">'dist'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(js|jsx)$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        use: [<span class="string">'babel-loader'</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  mode: <span class="string">'none'</span>,</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      minSize: <span class="number">0</span>,</span><br><span class="line">      cacheGroups: &#123;</span><br><span class="line">        commons: &#123;</span><br><span class="line">          name: <span class="string">'commons'</span>,</span><br><span class="line">          chunks: <span class="string">'all'</span>,</span><br><span class="line">          minChunks: <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">    <span class="keyword">new</span> webpack.DefinePlugin(&#123;<span class="comment">/**webpack 内置插件 */</span></span><br><span class="line">      <span class="string">'process.env'</span>: &#123;</span><br><span class="line">        NODE_ENV: process.env.NODE_ENV <span class="comment">/**将属性转化为全局变量，可正常访问 */</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;),</span><br><span class="line">  ]</span><br><span class="line">    .concat(...htmlWebpackPlugins)</span><br><span class="line">    .concat(HtmlWebpackExternalsPlugins)</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="启动-热更新-webpack-dev-server"><a href="#启动-热更新-webpack-dev-server" class="headerlink" title="启动 热更新 webpack-dev-server"></a>启动 热更新 webpack-dev-server</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add webpack-dev-server -D</span><br></pre></td></tr></table></figure>

<ul>
<li>配置启动脚本</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"scripts"</span>:&#123;</span><br><span class="line">        <span class="string">"dev"</span>:<span class="string">"webpack server --config webpack.dev.js --open"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>配置 webpack.dev.js </li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode:<span class="string">'development'</span>,</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        port: <span class="number">3000</span>,</span><br><span class="line">        compress: <span class="literal">false</span>,</span><br><span class="line">        <span class="keyword">static</span>: &#123;</span><br><span class="line">          directory: path.join(process.cwd(), <span class="string">'public'</span>),</span><br><span class="line">          publicPath: <span class="string">'/'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        client: &#123;</span><br><span class="line">          overlay: &#123;</span><br><span class="line">            errors: <span class="literal">true</span>,</span><br><span class="line">            warnings: <span class="literal">false</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>执行脚本</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn run dev</span><br></pre></td></tr></table></figure>

<h1 id="loader"><a href="#loader" class="headerlink" title="loader"></a>loader</h1><h2 id="css-css-loader-与-style-loader"><a href="#css-css-loader-与-style-loader" class="headerlink" title="css:css-loader 与 style-loader"></a>css:css-loader 与 style-loader</h2><ul>
<li>css-loader 会对 <code>@import 和 url()</code> 进行处理</li>
<li>style-loader 将 <code>css 注入到 js</code> 中，通过 DOM 操作控制 css</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add css-loader less-loader less -D</span><br></pre></td></tr></table></figure>

<h2 id="处理文件-图片、字体等"><a href="#处理文件-图片、字体等" class="headerlink" title="处理文件(图片、字体等)"></a>处理文件(图片、字体等)</h2><p>webpack 5 内置了 <code>资源模块（asset module）</code>，替代了 <code>file-loader</code> 和 <code>url-loader</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.(png|svg|jpg|jpeg|gif)$/</span>,</span><br><span class="line">    type:<span class="string">'asset'</span>,</span><br><span class="line">    generator: &#123;</span><br><span class="line">        filename: <span class="string">"static/img/[name].[hash:7].ext"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="css-增强（兼容前缀）"><a href="#css-增强（兼容前缀）" class="headerlink" title="css 增强（兼容前缀）"></a>css 增强（兼容前缀）</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add postcss-loader autoprefixer -D</span><br></pre></td></tr></table></figure>

<ul>
<li>执行顺序是 less-loader -&gt; postcss-loader -&gt; css-loader -&gt; style-loader</li>
<li>use 属性中自下而上执行</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="built_in">module</span>:&#123;</span><br><span class="line">        rules:[</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                  <span class="string">'style-loader'</span>,</span><br><span class="line">                  <span class="string">'css-loader'</span>,</span><br><span class="line">                  &#123;</span><br><span class="line">                    loader: <span class="string">'postcss-loader'</span>,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                      postcssOptions: &#123;</span><br><span class="line">                        plugins: [<span class="string">'autoprefixer'</span>]</span><br><span class="line">                      &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                  &#125;,</span><br><span class="line">                  <span class="string">'less-loader'</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>同时需要配置浏览器兼容范围 browserslist 配置</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"browserslist"</span>:&#123;</span><br><span class="line">         <span class="attr">"production"</span>: [</span><br><span class="line">          <span class="string">"&gt;0.2%"</span>,</span><br><span class="line">          <span class="string">"not dead"</span>,</span><br><span class="line">          <span class="string">"not op_mini all"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"development"</span>: [</span><br><span class="line">          <span class="string">"last 1 chrome version"</span>,</span><br><span class="line">          <span class="string">"last 1 firefox version"</span>,</span><br><span class="line">          <span class="string">"last 1 safari version"</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="css-抽离独立文件（分离css）"><a href="#css-抽离独立文件（分离css）" class="headerlink" title="css 抽离独立文件（分离css）"></a>css 抽离独立文件（分离css）</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add mini-css-extract-plugin -D</span><br></pre></td></tr></table></figure>

<ul>
<li>开发环境不需要样式分离</li>
<li>生产环境进行样式分离</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">'mini-css-extract-plugin'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode:<span class="string">'production'</span>,</span><br><span class="line">    <span class="built_in">module</span>:&#123;</span><br><span class="line">        rules:[</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                  MiniCssExtractPlugin.loader,</span><br><span class="line">                  <span class="comment">// 'style-loader',</span></span><br><span class="line">                  <span class="string">'css-loader'</span>,</span><br><span class="line">                  &#123;</span><br><span class="line">                    loader: <span class="string">'postcss-loader'</span>,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                      postcssOptions: &#123;</span><br><span class="line">                        plugins: [<span class="string">'autoprefixer'</span>]</span><br><span class="line">                      &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                  &#125;,</span><br><span class="line">                  <span class="string">'less-loader'</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins:[</span><br><span class="line">        <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">            filename: <span class="string">'[name]_[hash:8].css'</span></span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>![image-20220609015413386](webpack 之 SSR（服务端渲染）/image-20220609015413386.png)</p>
<h2 id="配置别名（绝对路径）"><a href="#配置别名（绝对路径）" class="headerlink" title="配置别名（绝对路径）"></a>配置别名（绝对路径）</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    resolve: &#123;</span><br><span class="line">        <span class="comment">// extensions: ['.js', '.jsx', '.ts', '.tsx', '.css', '.less', 'svg'],</span></span><br><span class="line">        alias: &#123;</span><br><span class="line">          <span class="string">'@'</span>: path.join(__dirname, <span class="string">'/'</span>),</span><br><span class="line">          <span class="string">'@server'</span>: path.join(__dirname, <span class="string">'/server'</span>),</span><br><span class="line">          <span class="string">'@src'</span>: path.join(__dirname, <span class="string">'/src'</span>),</span><br><span class="line">          <span class="string">'@comp'</span>: path.join(__dirname, <span class="string">'/src/components'</span>),</span><br><span class="line">          <span class="string">'@images'</span>: path.join(__dirname, <span class="string">'/src/assets/images'</span>),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="代码分离"><a href="#代码分离" class="headerlink" title="代码分离"></a>代码分离</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    optimization: &#123;</span><br><span class="line">        splitChunks: &#123;</span><br><span class="line">          chunks: <span class="string">'all'</span>,</span><br><span class="line">          name: <span class="string">'vendor'</span>,</span><br><span class="line">          cacheGroups: &#123;</span><br><span class="line">            <span class="string">'echarts.vendor'</span>: &#123;</span><br><span class="line">              name: <span class="string">'echarts.vendor'</span>,</span><br><span class="line">              priority: <span class="number">40</span>,</span><br><span class="line">              test: <span class="regexp">/[\\/]node_modules[\\/](echarts|zrender)[\\/]/</span>,</span><br><span class="line">              chunks: <span class="string">'all'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">'lodash'</span>: &#123;</span><br><span class="line">              name: <span class="string">'lodash'</span>,</span><br><span class="line">              chunks: <span class="string">'async'</span>,</span><br><span class="line">              test: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">              priority: <span class="number">40</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">'async-common'</span>: &#123;</span><br><span class="line">              chunks: <span class="string">'async'</span>,</span><br><span class="line">              minChunks: <span class="number">2</span>,</span><br><span class="line">              name: <span class="string">'async-commons'</span>,</span><br><span class="line">              priority: <span class="number">30</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            commons: &#123;</span><br><span class="line">              name: <span class="string">'commons'</span>,</span><br><span class="line">              chunks: <span class="string">'all'</span>,</span><br><span class="line">              minChunks: <span class="number">2</span>,</span><br><span class="line">              priority: <span class="number">20</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="非动态导入-echarts"><a href="#非动态导入-echarts" class="headerlink" title="非动态导入 echarts"></a>非动态导入 echarts</h1><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add echarts -S</span><br></pre></td></tr></table></figure>

<ul>
<li>新建 /src/echarts.js</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> echarts <span class="keyword">from</span> <span class="string">"echarts"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> myChart = echarts.init(<span class="built_in">document</span>.getElementById(<span class="string">'main'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定图表的配置项和数据</span></span><br><span class="line"><span class="keyword">var</span> option = &#123;</span><br><span class="line">  title: &#123;</span><br><span class="line">    text: <span class="string">'ECharts 入门示例'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  tooltip: &#123;&#125;,</span><br><span class="line">  legend: &#123;</span><br><span class="line">    data: [<span class="string">'销量'</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  xAxis: &#123;</span><br><span class="line">    data: [<span class="string">'衬衫'</span>, <span class="string">'羊毛衫'</span>, <span class="string">'雪纺衫'</span>, <span class="string">'裤子'</span>, <span class="string">'高跟鞋'</span>, <span class="string">'袜子'</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  yAxis: &#123;&#125;,</span><br><span class="line">  series: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">'销量'</span>,</span><br><span class="line">      type: <span class="string">'bar'</span>,</span><br><span class="line">      data: [<span class="number">5</span>, <span class="number">20</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">20</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用刚指定的配置项和数据显示图表。</span></span><br><span class="line">myChart.setOption(option);</span><br></pre></td></tr></table></figure>

<ul>
<li>入口模板文件中设置根元素 id 为 main </li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Index<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"root"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">+    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"main"</span></span></span><br><span class="line"><span class="tag">+         <span class="attr">style</span>=<span class="string">"width: 600px; height: 400px"</span>&gt;</span>dddd<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>入口文件 index.jsx 中直接引入即可</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createRoot &#125; <span class="keyword">from</span> <span class="string">'react-dom/client'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./index.less'</span>;</span><br><span class="line"><span class="comment">// import logo from '../assets/images/favicon.ico';</span></span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">'@images/favicon.ico'</span>;</span><br><span class="line"><span class="keyword">import</span> Demo <span class="keyword">from</span> <span class="string">'@comp/demo.jsx'</span>;</span><br><span class="line">+<span class="keyword">import</span> <span class="string">'@src/echarts'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>This is Index page<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">      &lt;img src=&#123;logo&#125; alt="icon" className="logo" /&gt;</span><br><span class="line">      55555</span><br><span class="line">      &lt;Demo /&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">const container = document.getElementById('root');</span><br><span class="line">const root = createRoot(container);</span><br><span class="line">root.render(&lt;Index /&gt;);</span><br></pre></td></tr></table></figure>

<p>![image-20220611021617990](webpack 之 SSR（服务端渲染）/image-20220611021617990.png)</p>
<h1 id="动态导入（按需加载-chunks）"><a href="#动态导入（按需加载-chunks）" class="headerlink" title="动态导入（按需加载 chunks）"></a>动态导入（按需加载 chunks）</h1><p>按需下载资源，如路由懒加载：可提高首屏加载速度</p>
<ul>
<li>安装 lodash</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add lodash -D</span><br></pre></td></tr></table></figure>

<ul>
<li>通过 import() 语法实现动态导入</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;&#125;;</span><br><span class="line">    <span class="keyword">this</span>.handleLazyLoad = <span class="keyword">this</span>.handleLazyLoad.bind(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">this</span>.testLodash = <span class="keyword">this</span>.testLodash.bind(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  handleLazyLoad() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">import</span>(<span class="string">'lodash'</span>).then(<span class="function">(<span class="params">&#123; <span class="keyword">default</span>: _ &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello, webpack<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  testLodash() &#123;</span><br><span class="line">    <span class="keyword">this</span>.handleLazyLoad().then(<span class="function"><span class="params">ele</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        newNode: ele</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.testLodash&#125;</span>&gt;</span>Lazy Load<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;this.state.newNode&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/&gt;</span>;</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>只有点击按钮，lodash 才会被加载</li>
</ul>
<p>![image-20220611043543074](webpack 之 SSR（服务端渲染）/image-20220611043543074.png)</p>
<h1 id="基于以上项目构建-SSR-渲染"><a href="#基于以上项目构建-SSR-渲染" class="headerlink" title="基于以上项目构建 SSR 渲染"></a>基于以上项目构建 SSR 渲染</h1><ul>
<li>安装 nodemon 实现热更新启动服务</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add nodemon -S</span><br></pre></td></tr></table></figure>

<ul>
<li>安装 node-jsx </li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add node-jsx -S</span><br></pre></td></tr></table></figure>

<ul>
<li>配置启动脚本</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">        <span class="attr">"ssr"</span>: <span class="string">"nodemon server/app.js"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>创建入口文件 search <code>/src/search/index-server.jsx</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"><span class="keyword">const</span> React = <span class="built_in">require</span>(<span class="string">'react'</span>);</span><br><span class="line"><span class="keyword">const</span> logo = <span class="built_in">require</span>(<span class="string">'@images/favicon.ico'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'./index.less'</span>);</span><br><span class="line"><span class="comment">// require('../../dist/abx'); /* 测试编译出错 */ </span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Search</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  handleChange(e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;&gt;</span>ddddd</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>This is Search page<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">      &lt;img src=&#123;logo&#125; alt="" /&gt;</span><br><span class="line">      sssss</span><br><span class="line"></span><br><span class="line">    &lt;/&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">module.exports = &lt;Search /&gt;;</span><br></pre></td></tr></table></figure>

<ul>
<li>新建 server/app.js 配置服务</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">  global.window = &#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; renderToString &#125; = <span class="built_in">require</span>(<span class="string">'react-dom/server'</span>);</span><br><span class="line"><span class="keyword">const</span> Search = <span class="built_in">require</span>(<span class="string">'../dist/search-server'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> template = fs.readFileSync(path.join(__dirname, <span class="string">'../dist/search.html'</span>), <span class="string">'utf-8'</span>);</span><br><span class="line"><span class="keyword">const</span> data = <span class="built_in">require</span>(<span class="string">'./data.json'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = <span class="function">(<span class="params">port</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">  app.use(express.static(<span class="string">'dist'</span>));</span><br><span class="line"></span><br><span class="line">  app.get(<span class="string">'/search'</span>, (req, res) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> html = renderMarkup(renderToString(Search));</span><br><span class="line">    res.status(<span class="number">200</span>).send(html);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  app.listen(port, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Server is running on port:'</span> + port);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">server(process.env.PORT || <span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> renderMarkup = <span class="function">(<span class="params">str</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> dataStr = <span class="built_in">JSON</span>.stringify(data);</span><br><span class="line">  <span class="keyword">return</span> template.replace(<span class="string">'&lt;!--HTML_PLACEHOLDER--&gt;'</span>, str)</span><br><span class="line">    .replace(<span class="string">'&lt;!--INITIAL_DATA_PLACEHOLDER--&gt;'</span>, <span class="string">`&lt;script&gt;window.__initial_data=<span class="subst">$&#123;dataStr&#125;</span>&lt;/script&gt;`</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><code>data.json 文件：首屏加载的数据内联到 html 中</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"error"</span>: [],</span><br><span class="line">  <span class="attr">"extra"</span>: [],</span><br><span class="line">  <span class="attr">"data"</span>: &#123;</span><br><span class="line">    <span class="attr">"list"</span>: [</span><br><span class="line">      [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"sub_count"</span>: <span class="number">5556</span>,</span><br><span class="line">          <span class="attr">"column_type"</span>: <span class="number">1</span>,</span><br><span class="line">          <span class="attr">"id"</span>: <span class="number">192</span>,</span><br><span class="line">          <span class="attr">"column_price_market"</span>: <span class="number">9900</span>,</span><br><span class="line">          <span class="attr">"column_bgcolor"</span>: <span class="string">"#F6F7FB"</span>,</span><br><span class="line">          <span class="attr">"column_title"</span>: <span class="string">"SQL必知必会"</span>,</span><br><span class="line">          <span class="attr">"column_cover_small"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/1c\/38\/1c5a5b154b543af952312eef33217438.jpg"</span>,</span><br><span class="line">          <span class="attr">"column_cover"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/c7\/0d\/c7ee0aabbcb6d2da09a1b4a56c1a730d.jpg"</span>,</span><br><span class="line">          <span class="attr">"had_sub"</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">"price_type"</span>: <span class="number">2</span>,</span><br><span class="line">          <span class="attr">"column_unit"</span>: <span class="string">"45讲"</span>,</span><br><span class="line">          <span class="attr">"is_experience"</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">"column_ctime"</span>: <span class="number">1559640855</span>,</span><br><span class="line">          <span class="attr">"update_frequency"</span>: <span class="string">"每周一 \/ 三 \/ 五更新"</span>,</span><br><span class="line">          <span class="attr">"is_onboard"</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"author_intro"</span>: <span class="string">"清华大学计算机博士"</span>,</span><br><span class="line">          <span class="attr">"column_sku"</span>: <span class="number">100029501</span>,</span><br><span class="line">          <span class="attr">"column_cover_wxlite"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/cd\/f0\/cd26b744d388dbd4387dcfaa66dd8bf0.jpg"</span>,</span><br><span class="line">          <span class="attr">"column_price"</span>: <span class="number">6800</span>,</span><br><span class="line">          <span class="attr">"column_price_sale"</span>: <span class="number">6800</span>,</span><br><span class="line">          <span class="attr">"author_name"</span>: <span class="string">"陈旸"</span>,</span><br><span class="line">          <span class="attr">"column_subtitle"</span>: <span class="string">"从入门到数据实战"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"sub_count"</span>: <span class="number">5446</span>,</span><br><span class="line">          <span class="attr">"column_type"</span>: <span class="number">1</span>,</span><br><span class="line">          <span class="attr">"id"</span>: <span class="number">191</span>,</span><br><span class="line">          <span class="attr">"column_price_market"</span>: <span class="number">9900</span>,</span><br><span class="line">          <span class="attr">"column_bgcolor"</span>: <span class="string">"#F6F7FB"</span>,</span><br><span class="line">          <span class="attr">"column_title"</span>: <span class="string">"Kafka核心技术与实战"</span>,</span><br><span class="line">          <span class="attr">"column_cover_small"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/be\/d9\/be55e9cfe7b542ef6284e3e5722b9bd9.jpg"</span>,</span><br><span class="line">          <span class="attr">"column_cover"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/49\/92\/49d8686324a61b106f9fbeb45c9d7192.jpg"</span>,</span><br><span class="line">          <span class="attr">"had_sub"</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">"price_type"</span>: <span class="number">1</span>,</span><br><span class="line">          <span class="attr">"column_unit"</span>: <span class="string">"42讲"</span>,</span><br><span class="line">          <span class="attr">"is_experience"</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">"column_ctime"</span>: <span class="number">1559009326</span>,</span><br><span class="line">          <span class="attr">"update_frequency"</span>: <span class="string">"每周二 \/ 四 \/ 六更新"</span>,</span><br><span class="line">          <span class="attr">"is_onboard"</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"author_intro"</span>: <span class="string">"人人贷计算平台部总监，Apache Kafka Contributor"</span>,</span><br><span class="line">          <span class="attr">"column_sku"</span>: <span class="number">100029201</span>,</span><br><span class="line">          <span class="attr">"column_cover_wxlite"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/fc\/f6\/fcddac07fdd4530b99b5a1049b6aa5f6.jpg"</span>,</span><br><span class="line">          <span class="attr">"column_price"</span>: <span class="number">9900</span>,</span><br><span class="line">          <span class="attr">"column_price_sale"</span>: <span class="number">9900</span>,</span><br><span class="line">          <span class="attr">"author_name"</span>: <span class="string">"胡夕"</span>,</span><br><span class="line">          <span class="attr">"column_subtitle"</span>: <span class="string">"全面提升你的Kafka实战能力"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"sub_count"</span>: <span class="number">4209</span>,</span><br><span class="line">          <span class="attr">"column_type"</span>: <span class="number">1</span>,</span><br><span class="line">          <span class="attr">"id"</span>: <span class="number">189</span>,</span><br><span class="line">          <span class="attr">"column_price_market"</span>: <span class="number">9900</span>,</span><br><span class="line">          <span class="attr">"column_bgcolor"</span>: <span class="string">"#F6F7FB"</span>,</span><br><span class="line">          <span class="attr">"column_title"</span>: <span class="string">"透视HTTP协议"</span>,</span><br><span class="line">          <span class="attr">"column_cover_small"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/7f\/6e\/7ff02fbdbc37331b10c5435dc86e4f6e.jpg"</span>,</span><br><span class="line">          <span class="attr">"column_cover"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/2a\/10\/2ac9b106533a4904f66041143a0e1b10.jpg"</span>,</span><br><span class="line">          <span class="attr">"had_sub"</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">"price_type"</span>: <span class="number">1</span>,</span><br><span class="line">          <span class="attr">"column_unit"</span>: <span class="string">"40讲"</span>,</span><br><span class="line">          <span class="attr">"is_experience"</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">"column_ctime"</span>: <span class="number">1558689100</span>,</span><br><span class="line">          <span class="attr">"update_frequency"</span>: <span class="string">"每周一／三／五更新"</span>,</span><br><span class="line">          <span class="attr">"is_onboard"</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"author_intro"</span>: <span class="string">"奇虎360技术专家，Nginx\/OpenResty开源项目贡献者"</span>,</span><br><span class="line">          <span class="attr">"column_sku"</span>: <span class="number">100029001</span>,</span><br><span class="line">          <span class="attr">"column_cover_wxlite"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/b6\/53\/b60efb231d0ccc797b4329cd58b57453.jpg"</span>,</span><br><span class="line">          <span class="attr">"column_price"</span>: <span class="number">9900</span>,</span><br><span class="line">          <span class="attr">"column_price_sale"</span>: <span class="number">9900</span>,</span><br><span class="line">          <span class="attr">"author_name"</span>: <span class="string">"罗剑锋（Chrono）"</span>,</span><br><span class="line">          <span class="attr">"column_subtitle"</span>: <span class="string">"深入理解HTTP协议本质与应用"</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"sub_count"</span>: <span class="number">1196</span>,</span><br><span class="line">          <span class="attr">"column_type"</span>: <span class="number">3</span>,</span><br><span class="line">          <span class="attr">"id"</span>: <span class="number">181</span>,</span><br><span class="line">          <span class="attr">"column_price_market"</span>: <span class="number">12900</span>,</span><br><span class="line">          <span class="attr">"column_bgcolor"</span>: <span class="string">"#FFFFFF"</span>,</span><br><span class="line">          <span class="attr">"column_title"</span>: <span class="string">"零基础学Java"</span>,</span><br><span class="line">          <span class="attr">"column_cover_small"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/1e\/d5\/1eb010e6535872bf773b222a68ef48d5.jpg"</span>,</span><br><span class="line">          <span class="attr">"column_cover"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/18\/b2\/18540a6c839dcd85527417e0a20ad5b2.jpg"</span>,</span><br><span class="line">          <span class="attr">"had_sub"</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">"price_type"</span>: <span class="number">1</span>,</span><br><span class="line">          <span class="attr">"column_unit"</span>: <span class="string">"141讲"</span>,</span><br><span class="line">          <span class="attr">"is_experience"</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">"column_ctime"</span>: <span class="number">1557310171</span>,</span><br><span class="line">          <span class="attr">"update_frequency"</span>: <span class="string">"141课时，约1500分钟"</span>,</span><br><span class="line">          <span class="attr">"is_onboard"</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"author_intro"</span>: <span class="string">"PayPal数据处理组技术负责人"</span>,</span><br><span class="line">          <span class="attr">"column_sku"</span>: <span class="number">100027801</span>,</span><br><span class="line">          <span class="attr">"column_cover_wxlite"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/f2\/56\/f24feba110c1c9a2d45799fe19ea9f56.jpg"</span>,</span><br><span class="line">          <span class="attr">"column_price"</span>: <span class="number">12900</span>,</span><br><span class="line">          <span class="attr">"column_price_sale"</span>: <span class="number">12900</span>,</span><br><span class="line">          <span class="attr">"author_name"</span>: <span class="string">"臧萌"</span>,</span><br><span class="line">          <span class="attr">"column_subtitle"</span>: <span class="string">"通俗易懂的Java入门课"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"sub_count"</span>: <span class="number">5120</span>,</span><br><span class="line">          <span class="attr">"column_type"</span>: <span class="number">3</span>,</span><br><span class="line">          <span class="attr">"id"</span>: <span class="number">175</span>,</span><br><span class="line">          <span class="attr">"column_price_market"</span>: <span class="number">12900</span>,</span><br><span class="line">          <span class="attr">"column_bgcolor"</span>: <span class="string">"#FFFFFF"</span>,</span><br><span class="line">          <span class="attr">"column_title"</span>: <span class="string">"Web协议详解与抓包实战"</span>,</span><br><span class="line">          <span class="attr">"column_cover_small"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/6f\/46\/6f1e665a01d20dd237cbdd2210563f46.jpg"</span>,</span><br><span class="line">          <span class="attr">"column_cover"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/04\/0a\/0430f8402be85def96111b2d4950290a.jpg"</span>,</span><br><span class="line">          <span class="attr">"had_sub"</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">"price_type"</span>: <span class="number">1</span>,</span><br><span class="line">          <span class="attr">"column_unit"</span>: <span class="string">"83讲"</span>,</span><br><span class="line">          <span class="attr">"is_experience"</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">"column_ctime"</span>: <span class="number">1556262573</span>,</span><br><span class="line">          <span class="attr">"update_frequency"</span>: <span class="string">"83课时，约1000分钟"</span>,</span><br><span class="line">          <span class="attr">"is_onboard"</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"author_intro"</span>: <span class="string">"智链达CTO，前阿里云高级技术专家"</span>,</span><br><span class="line">          <span class="attr">"column_sku"</span>: <span class="number">100026801</span>,</span><br><span class="line">          <span class="attr">"column_cover_wxlite"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/cf\/6d\/cf98743409df276e2dce76631dd1a56d.jpg"</span>,</span><br><span class="line">          <span class="attr">"column_price"</span>: <span class="number">12900</span>,</span><br><span class="line">          <span class="attr">"column_price_sale"</span>: <span class="number">12900</span>,</span><br><span class="line">          <span class="attr">"author_name"</span>: <span class="string">"陶辉"</span>,</span><br><span class="line">          <span class="attr">"column_subtitle"</span>: <span class="string">"系统掌握Web协议，高效解决网络难题"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"sub_count"</span>: <span class="number">1390</span>,</span><br><span class="line">          <span class="attr">"column_type"</span>: <span class="number">3</span>,</span><br><span class="line">          <span class="attr">"id"</span>: <span class="number">169</span>,</span><br><span class="line">          <span class="attr">"column_price_market"</span>: <span class="number">12900</span>,</span><br><span class="line">          <span class="attr">"column_bgcolor"</span>: <span class="string">"#FFFFFF"</span>,</span><br><span class="line">          <span class="attr">"column_title"</span>: <span class="string">"从0开发一款iOS App"</span>,</span><br><span class="line">          <span class="attr">"column_cover_small"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/fd\/c6\/fd828461c4a3cfa0a6a93dd1817001c6.jpg"</span>,</span><br><span class="line">          <span class="attr">"column_cover"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/19\/46\/198d9604ea72cfb812442ab2b5d01b46.jpg"</span>,</span><br><span class="line">          <span class="attr">"had_sub"</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">"price_type"</span>: <span class="number">3</span>,</span><br><span class="line">          <span class="attr">"column_unit"</span>: <span class="string">"61讲"</span>,</span><br><span class="line">          <span class="attr">"is_experience"</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">"column_ctime"</span>: <span class="number">1555323160</span>,</span><br><span class="line">          <span class="attr">"update_frequency"</span>: <span class="string">"61课时，约500分钟"</span>,</span><br><span class="line">          <span class="attr">"is_onboard"</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"author_intro"</span>: <span class="string">"腾讯高级工程师"</span>,</span><br><span class="line">          <span class="attr">"column_sku"</span>: <span class="number">100025901</span>,</span><br><span class="line">          <span class="attr">"column_cover_wxlite"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/b6\/78\/b67742c736399370628bfc202b646f78.jpg"</span>,</span><br><span class="line">          <span class="attr">"column_price"</span>: <span class="number">9900</span>,</span><br><span class="line">          <span class="attr">"column_price_sale"</span>: <span class="number">12900</span>,</span><br><span class="line">          <span class="attr">"author_name"</span>: <span class="string">"朱德权"</span>,</span><br><span class="line">          <span class="attr">"column_subtitle"</span>: <span class="string">"手把手带你构建类今日头条的App"</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"sub_count"</span>: <span class="number">9580</span>,</span><br><span class="line">          <span class="attr">"column_type"</span>: <span class="number">2</span>,</span><br><span class="line">          <span class="attr">"id"</span>: <span class="number">75</span>,</span><br><span class="line">          <span class="attr">"column_price_market"</span>: <span class="number">900</span>,</span><br><span class="line">          <span class="attr">"column_bgcolor"</span>: <span class="string">"#ffffff"</span>,</span><br><span class="line">          <span class="attr">"column_title"</span>: <span class="string">"深入浅出gRPC"</span>,</span><br><span class="line">          <span class="attr">"column_cover_small"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/f3\/f6\/f3abb28a927bf207332f7ce41c5e3bf6.png"</span>,</span><br><span class="line">          <span class="attr">"column_cover"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/73\/a0\/73abcab9cd7e8127d15dc11e84339ea0.jpg"</span>,</span><br><span class="line">          <span class="attr">"had_sub"</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">"price_type"</span>: <span class="number">1</span>,</span><br><span class="line">          <span class="attr">"column_unit"</span>: <span class="string">"6讲"</span>,</span><br><span class="line">          <span class="attr">"is_experience"</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">"column_ctime"</span>: <span class="number">1520409029</span>,</span><br><span class="line">          <span class="attr">"update_frequency"</span>: <span class="string">"全集"</span>,</span><br><span class="line">          <span class="attr">"is_onboard"</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"author_intro"</span>: <span class="string">"《Netty 权威指南》、《分布式服务框架原理与实践》作者。"</span>,</span><br><span class="line">          <span class="attr">"column_sku"</span>: <span class="number">100005601</span>,</span><br><span class="line">          <span class="attr">"column_cover_wxlite"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/fe\/57\/fe319ec636d61d7b30a46bedf6b80657.jpg"</span>,</span><br><span class="line">          <span class="attr">"column_price"</span>: <span class="number">900</span>,</span><br><span class="line">          <span class="attr">"column_price_sale"</span>: <span class="number">900</span>,</span><br><span class="line">          <span class="attr">"author_name"</span>: <span class="string">"李林锋"</span>,</span><br><span class="line">          <span class="attr">"column_subtitle"</span>: <span class="string">"详解gRPC运作机制与原理"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"sub_count"</span>: <span class="number">5761</span>,</span><br><span class="line">          <span class="attr">"column_type"</span>: <span class="number">2</span>,</span><br><span class="line">          <span class="attr">"id"</span>: <span class="number">73</span>,</span><br><span class="line">          <span class="attr">"column_price_market"</span>: <span class="number">900</span>,</span><br><span class="line">          <span class="attr">"column_bgcolor"</span>: <span class="string">"#ffffff"</span>,</span><br><span class="line">          <span class="attr">"column_title"</span>: <span class="string">"Service Mesh实践指南"</span>,</span><br><span class="line">          <span class="attr">"column_cover_small"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/62\/c8\/6219bb77d64a1d4f0492e462fbc914c8.png"</span>,</span><br><span class="line">          <span class="attr">"column_cover"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/3d\/75\/3d12373859e03012332614996351ce75.jpg"</span>,</span><br><span class="line">          <span class="attr">"had_sub"</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">"price_type"</span>: <span class="number">1</span>,</span><br><span class="line">          <span class="attr">"column_unit"</span>: <span class="string">"6讲"</span>,</span><br><span class="line">          <span class="attr">"is_experience"</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">"column_ctime"</span>: <span class="number">1518082159</span>,</span><br><span class="line">          <span class="attr">"update_frequency"</span>: <span class="string">"全集"</span>,</span><br><span class="line">          <span class="attr">"is_onboard"</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"author_intro"</span>: <span class="string">"微博平台研发技术专家，高性能OpenResty开发框架Vanilla作者。"</span>,</span><br><span class="line">          <span class="attr">"column_sku"</span>: <span class="number">100005401</span>,</span><br><span class="line">          <span class="attr">"column_cover_wxlite"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/ea\/54\/eacd1c6a1889c86f7d514f049228af54.jpg"</span>,</span><br><span class="line">          <span class="attr">"column_price"</span>: <span class="number">900</span>,</span><br><span class="line">          <span class="attr">"column_price_sale"</span>: <span class="number">900</span>,</span><br><span class="line">          <span class="attr">"author_name"</span>: <span class="string">"周晶"</span>,</span><br><span class="line">          <span class="attr">"column_subtitle"</span>: <span class="string">"来自一线大厂的第一手经验总结"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"sub_count"</span>: <span class="number">15259</span>,</span><br><span class="line">          <span class="attr">"column_type"</span>: <span class="number">2</span>,</span><br><span class="line">          <span class="attr">"id"</span>: <span class="number">61</span>,</span><br><span class="line">          <span class="attr">"column_price_market"</span>: <span class="number">100</span>,</span><br><span class="line">          <span class="attr">"column_bgcolor"</span>: <span class="string">"#eac44b"</span>,</span><br><span class="line">          <span class="attr">"column_title"</span>: <span class="string">"如何做好一场技术演讲"</span>,</span><br><span class="line">          <span class="attr">"column_cover_small"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/cc\/fb\/ccb3acf6fcfab959aee1d800b882f7fb.png"</span>,</span><br><span class="line">          <span class="attr">"column_cover"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/0a\/2d\/0a3ec20c90b059cab58e15e91d02662d.jpg"</span>,</span><br><span class="line">          <span class="attr">"had_sub"</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">"price_type"</span>: <span class="number">1</span>,</span><br><span class="line">          <span class="attr">"column_unit"</span>: <span class="string">"6讲"</span>,</span><br><span class="line">          <span class="attr">"is_experience"</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">"column_ctime"</span>: <span class="number">1511953968</span>,</span><br><span class="line">          <span class="attr">"update_frequency"</span>: <span class="string">"全集"</span>,</span><br><span class="line">          <span class="attr">"is_onboard"</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"author_intro"</span>: <span class="string">"极客时间编辑部"</span>,</span><br><span class="line">          <span class="attr">"column_sku"</span>: <span class="number">100003001</span>,</span><br><span class="line">          <span class="attr">"column_cover_wxlite"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/d3\/a4\/d33c2ee1b89006207992bcc7d26ff8a4.jpg"</span>,</span><br><span class="line">          <span class="attr">"column_price"</span>: <span class="number">100</span>,</span><br><span class="line">          <span class="attr">"column_price_sale"</span>: <span class="number">100</span>,</span><br><span class="line">          <span class="attr">"author_name"</span>: <span class="string">"极客时间"</span>,</span><br><span class="line">          <span class="attr">"column_subtitle"</span>: <span class="string">"程序员都应该学学怎么表达"</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"nav"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"专栏"</span>,</span><br><span class="line">        <span class="attr">"color"</span>: <span class="string">"#5ba6ff"</span>,</span><br><span class="line">        <span class="attr">"icon"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/dd\/9e\/dd8cbc79f017d1b01f643c7ea929d79e.png"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"视频课程"</span>,</span><br><span class="line">        <span class="attr">"color"</span>: <span class="string">"#79c109"</span>,</span><br><span class="line">        <span class="attr">"icon"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/4a\/c3\/4aebe8fb752fa21a0fd989a45d9847c3.png"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"微课"</span>,</span><br><span class="line">        <span class="attr">"color"</span>: <span class="string">"#5ba6ff"</span>,</span><br><span class="line">        <span class="attr">"icon"</span>: <span class="string">"https:\/\/static001.geekbang.org\/resource\/image\/9c\/f1\/9c223ccae33c5245a3009857582f1df1.png"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"code"</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>webpack 配置文件大体内容和 <code>生产环境一致</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">'mini-css-extract-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackExternalsPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-externals-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> FriendlyErrorsWebpackPlugin = <span class="built_in">require</span>(<span class="string">'friendly-errors-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> glob = <span class="built_in">require</span>(<span class="string">'glob'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> setMPA = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> entry = &#123;&#125;;</span><br><span class="line">  <span class="keyword">let</span> htmlWebpackPlugins = [];</span><br><span class="line">  <span class="keyword">let</span> HtmlWebpackExternalsPlugins = [];</span><br><span class="line">  <span class="keyword">let</span> url = path.join(__dirname, <span class="string">'/src/*/index-server.jsx'</span>).replaceAll(<span class="string">'\\'</span>, <span class="string">'/'</span>);</span><br><span class="line">  <span class="keyword">const</span> entryFiles = glob.sync(url);</span><br><span class="line">  <span class="built_in">Object</span>.keys(entryFiles).map(<span class="function"><span class="params">index</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> entryFile = entryFiles[index];</span><br><span class="line">    <span class="keyword">let</span> match = entryFile.match(<span class="regexp">/src\/(.*)\/index-server.jsx/</span>);</span><br><span class="line">    <span class="keyword">const</span> pageName = match &amp;&amp; match[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span> (pageName) &#123;</span><br><span class="line">      entry[pageName] = entryFile;</span><br><span class="line">      <span class="comment">// 每个入口文件设置 基础库的cdn</span></span><br><span class="line">      <span class="comment">// HtmlWebpackExternalsPlugins.push(new HtmlWebpackExternalsPlugin(&#123;</span></span><br><span class="line">      <span class="comment">//   externals: [</span></span><br><span class="line">      <span class="comment">//     &#123;</span></span><br><span class="line">      <span class="comment">//       module: 'react',</span></span><br><span class="line">      <span class="comment">//       entry: 'https://unpkg.com/react@18/umd/react.development.js',</span></span><br><span class="line">      <span class="comment">//       global: 'React'</span></span><br><span class="line">      <span class="comment">//     &#125;,</span></span><br><span class="line">      <span class="comment">//     &#123;</span></span><br><span class="line">      <span class="comment">//       module: 'react-dom',</span></span><br><span class="line">      <span class="comment">//       entry: 'https://unpkg.com/react-dom@18/umd/react-dom.development.js',</span></span><br><span class="line">      <span class="comment">//       global: 'ReactDOM'</span></span><br><span class="line">      <span class="comment">//     &#125;</span></span><br><span class="line">      <span class="comment">//   ],</span></span><br><span class="line">      <span class="comment">//   files: [`$&#123;pageName&#125;.html`]</span></span><br><span class="line">      <span class="comment">// &#125;));</span></span><br><span class="line">      <span class="comment">// 入口文件生成模板</span></span><br><span class="line">      htmlWebpackPlugins.push(</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">          template: path.join(__dirname, <span class="string">`/src/<span class="subst">$&#123;pageName&#125;</span>/index.html`</span>),</span><br><span class="line">          filename: <span class="string">`<span class="subst">$&#123;pageName&#125;</span>.html`</span>,</span><br><span class="line">          chunks: [pageName],</span><br><span class="line">          inject: <span class="literal">true</span>,</span><br><span class="line">          minify: &#123;</span><br><span class="line">            html5: <span class="literal">true</span>,</span><br><span class="line">            collapseWhitespace: <span class="literal">false</span>,</span><br><span class="line">            preserveLineBreaks: <span class="literal">false</span>,</span><br><span class="line">            minifyCSS: <span class="literal">false</span>,</span><br><span class="line">            minifyJS: <span class="literal">false</span>,</span><br><span class="line">            removeComments: <span class="literal">false</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; entry, htmlWebpackPlugins, HtmlWebpackExternalsPlugins &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; entry, htmlWebpackPlugins, HtmlWebpackExternalsPlugins &#125; = setMPA();</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'[name]-server.js'</span>,</span><br><span class="line">    path: path.join(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    libraryTarget: <span class="string">'umd'</span>,</span><br><span class="line">    globalObject: <span class="string">'this'</span>,</span><br><span class="line">    publicPath: <span class="string">''</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  mode: <span class="string">'none'</span>,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(js|jsx)$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        use: [<span class="string">'babel-loader'</span>]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        use: [MiniCssExtractPlugin.loader, <span class="string">'css-loader'</span>, <span class="string">'less-loader'</span>]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [MiniCssExtractPlugin.loader, <span class="string">'css-loader'</span>]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(png|jpg|jpeg|woff|ico|woff2|eot|ttf)$/</span>,</span><br><span class="line">        type: <span class="string">'asset'</span>,</span><br><span class="line">        parser: &#123;</span><br><span class="line">          dataUrlCondition: &#123;</span><br><span class="line">            maxSize: <span class="number">10</span> * <span class="number">2014</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  mode: <span class="string">'none'</span>,</span><br><span class="line">  <span class="comment">// optimization: &#123;</span></span><br><span class="line">  <span class="comment">//   splitChunks: &#123;</span></span><br><span class="line">  <span class="comment">//     minSize: 0,</span></span><br><span class="line">  <span class="comment">//     cacheGroups: &#123;</span></span><br><span class="line">  <span class="comment">//       commons: &#123;</span></span><br><span class="line">  <span class="comment">//         name: 'commons',</span></span><br><span class="line">  <span class="comment">//         chunks: 'all',</span></span><br><span class="line">  <span class="comment">//         minChunks: 2</span></span><br><span class="line">  <span class="comment">//       &#125;</span></span><br><span class="line">  <span class="comment">//     &#125;</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">  <span class="comment">// &#125;,</span></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> FriendlyErrorsWebpackPlugin(),</span><br><span class="line">    <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">      filename: <span class="string">'[name].css'</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">    <span class="keyword">new</span> webpack.DefinePlugin(&#123;<span class="comment">/**webpack 内置插件 */</span></span><br><span class="line">      <span class="string">'process.env'</span>: &#123;</span><br><span class="line">        NODE_ENV: process.env.NODE_ENV <span class="comment">/**将属性转化为全局变量，可正常访问 */</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">/* 打包捕获 error */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.hooks.done.tap(<span class="string">'done'</span>, stats =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (stats.compilation.errors &amp;&amp; stats.compilation.errors.length &amp;&amp; process.argv.indexOf(<span class="string">'--watch'</span>) == <span class="number">-1</span>) &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'build error'</span>);</span><br><span class="line">          process.exit(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">    .concat(htmlWebpackPlugins)</span><br><span class="line">    .concat(HtmlWebpackExternalsPlugins),</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    <span class="comment">// extensions: ['.js', '.jsx', '.ts', '.tsx', '.css', '.less', 'svg'],</span></span><br><span class="line">    alias: &#123;</span><br><span class="line">      <span class="string">'@'</span>: path.join(__dirname, <span class="string">'/'</span>),</span><br><span class="line">      <span class="string">'@server'</span>: path.join(__dirname, <span class="string">'/server'</span>),</span><br><span class="line">      <span class="string">'@src'</span>: path.join(__dirname, <span class="string">'/src'</span>),</span><br><span class="line">      <span class="string">'@comp'</span>: path.join(__dirname, <span class="string">'/src/components'</span>),</span><br><span class="line">      <span class="string">'@images'</span>: path.join(__dirname, <span class="string">'/src/assets/images'</span>),</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  stats: <span class="string">'errors-only'</span> <span class="comment">/* 设置编译信息提示内容 */</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="项目插件"><a href="#项目插件" class="headerlink" title="项目插件"></a>项目插件</h1><ul>
<li>clean-webpack-plugin 每次构建清除上次构建的文件</li>
<li>html-webpack-plugin 生成 html 模板承载 js </li>
<li>html-webpack-externals-plugin 基础库的 cdn 设置</li>
<li>friendly-errors-webpack-plugin 为每次编译提供友好提示</li>
<li>glob 读取文件</li>
</ul>
<h1 id="PS：SSR关闭webpack-optimization配置"><a href="#PS：SSR关闭webpack-optimization配置" class="headerlink" title="PS：SSR关闭webpack optimization配置"></a>PS：SSR关闭webpack optimization配置</h1><h1 id="webpack中-stats-选项设置显示的编译信息种类"><a href="#webpack中-stats-选项设置显示的编译信息种类" class="headerlink" title="webpack中 stats 选项设置显示的编译信息种类"></a>webpack中 stats 选项设置显示的编译信息种类</h1><h1 id="ssr-中样式无法显示问题"><a href="#ssr-中样式无法显示问题" class="headerlink" title="ssr 中样式无法显示问题"></a>ssr 中样式无法显示问题</h1><ul>
<li>法一：可设置 ignore-loader 直接忽略 css 的解析</li>
<li>法二：也可将 style-loader 替换成 <code>isomorphic-style-loader</code>（但是该方法需要改变编码习惯，使用另一种方式来设置样式，不建议使用）</li>
<li>法三：使用 mini-css-extract-plugin 设置样式外联，通过html模板文件中设置占位符，在 app.js 文件中替换占位符的方式完成样式的解析<ul>
<li>将整个文件导入，通过 renderToString 转换后，替换模板中字符来实现</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> app.get(<span class="string">'/search'</span>, (req, res) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> html = renderMarkup(renderToString(Search));</span><br><span class="line">    res.status(<span class="number">200</span>).send(html);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">-------------------------------------------------</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> renderMarkup = <span class="function">(<span class="params">str</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> dataStr = <span class="built_in">JSON</span>.stringify(data);</span><br><span class="line">  <span class="keyword">return</span> template.replace(<span class="string">'&lt;!--HTML_PLACEHOLDER--&gt;'</span>, str)</span><br><span class="line">    .replace(<span class="string">'&lt;!--INITIAL_DATA_PLACEHOLDER--&gt;'</span>, <span class="string">`&lt;script&gt;window.__initial_data=<span class="subst">$&#123;dataStr&#125;</span>&lt;/script&gt;`</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

    <div>
      
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

      
    </div>

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/webpack/" rel="tag"><i class="fa fa-tag"></i>webpack</a>
              <a href="/tags/SSR/" rel="tag"><i class="fa fa-tag"></i>SSR</a>
              <a href="/tags/服务端渲染/" rel="tag"><i class="fa fa-tag"></i>服务端渲染</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/2022/06/28/webpack 之 构建包设计/" rel="next" title="将构建配置抽离成 npm 包的意义">
                  <i class="fa fa-chevron-left"></i> 将构建配置抽离成 npm 包的意义
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/2022/07/12/Vue3/" rel="prev" title="Vue3">
                  Vue3 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#SSR-（Server-Side-Render）与-CSR（Client-Side-Render）"><span class="nav-number">1.</span> <span class="nav-text">SSR （Server Side Render）与 CSR（Client Side Render）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#创建项目"><span class="nav-number">2.</span> <span class="nav-text">创建项目</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#配置-webpack-服务端打包文件"><span class="nav-number">3.</span> <span class="nav-text">配置 webpack 服务端打包文件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#webpack-ssr-js-配置文件"><span class="nav-number">3.1.</span> <span class="nav-text">webpack.ssr.js 配置文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置打包脚本"><span class="nav-number">3.2.</span> <span class="nav-text">配置打包脚本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装依赖"><span class="nav-number">3.3.</span> <span class="nav-text">安装依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#es6-模块兼容"><span class="nav-number">3.4.</span> <span class="nav-text">es6 模块兼容</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#重新构建，自动清除构建文件"><span class="nav-number">3.5.</span> <span class="nav-text">重新构建，自动清除构建文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#动态生成-html-模板"><span class="nav-number">3.6.</span> <span class="nav-text">动态生成 html 模板</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#分离基础包"><span class="nav-number">3.7.</span> <span class="nav-text">分离基础包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#启动-热更新-webpack-dev-server"><span class="nav-number">3.8.</span> <span class="nav-text">启动 热更新 webpack-dev-server</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#loader"><span class="nav-number">4.</span> <span class="nav-text">loader</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#css-css-loader-与-style-loader"><span class="nav-number">4.1.</span> <span class="nav-text">css:css-loader 与 style-loader</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#处理文件-图片、字体等"><span class="nav-number">4.2.</span> <span class="nav-text">处理文件(图片、字体等)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#css-增强（兼容前缀）"><span class="nav-number">4.3.</span> <span class="nav-text">css 增强（兼容前缀）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#css-抽离独立文件（分离css）"><span class="nav-number">4.4.</span> <span class="nav-text">css 抽离独立文件（分离css）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置别名（绝对路径）"><span class="nav-number">4.5.</span> <span class="nav-text">配置别名（绝对路径）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#代码分离"><span class="nav-number">4.6.</span> <span class="nav-text">代码分离</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#非动态导入-echarts"><span class="nav-number">5.</span> <span class="nav-text">非动态导入 echarts</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#动态导入（按需加载-chunks）"><span class="nav-number">6.</span> <span class="nav-text">动态导入（按需加载 chunks）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#基于以上项目构建-SSR-渲染"><span class="nav-number">7.</span> <span class="nav-text">基于以上项目构建 SSR 渲染</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#项目插件"><span class="nav-number">8.</span> <span class="nav-text">项目插件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PS：SSR关闭webpack-optimization配置"><span class="nav-number">9.</span> <span class="nav-text">PS：SSR关闭webpack optimization配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#webpack中-stats-选项设置显示的编译信息种类"><span class="nav-number">10.</span> <span class="nav-text">webpack中 stats 选项设置显示的编译信息种类</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ssr-中样式无法显示问题"><span class="nav-number">11.</span> <span class="nav-text">ssr 中样式无法显示问题</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Yana"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Yana</p>
  <div class="site-description" itemprop="description">Never give up！</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">87</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">104</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">102</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/yanadev" title="GitHub → https://github.com/yanadev" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/null" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yana</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">284k</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
<script src="/js/utils.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  
















  

  

  
  <script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
  
</body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>
